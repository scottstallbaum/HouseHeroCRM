<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>House Hero CRM</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,400;0,700;0,900;1,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar__brand">
      <img src="logo.png" alt="House Hero" class="sidebar__logo"
        onerror="this.style.display='none'; document.getElementById('brand-fallback').style.display='block'" />
      <div id="brand-fallback" style="display:none">
        <div class="sidebar__brand-name">House Hero</div>
        <div class="sidebar__brand-sub">CRM</div>
      </div>
    </div>
    <nav class="sidebar__nav">
      <a href="#" class="sidebar__link sidebar__link--active" data-view="customers">
        <span class="sidebar__icon">üë•</span> Customers
      </a>
      <a href="#" class="sidebar__link" data-view="prospects">
        <span class="sidebar__icon">üéØ</span> Prospects
      </a>
      <a href="#" class="sidebar__link" data-view="calendar">
        <span class="sidebar__icon">üóìÔ∏è</span> Calendar
      </a>
      <a href="#" class="sidebar__link" data-view="technicians">
        <span class="sidebar__icon">üîß</span> Technicians
      </a>
      <a href="#" class="sidebar__link" data-view="schedule">
        <span class="sidebar__icon">üìÖ</span> Schedule
      </a>
      <a href="#" class="sidebar__link" data-view="task-library">
        <span class="sidebar__icon">üìã</span> Task Library
      </a>
    </nav>
    <div class="sidebar__footer">
      <div class="sidebar__footer-text">House Hero LLC</div>
      <div class="sidebar__footer-sub">PA Registered & Insured</div>
      <div class="sidebar__user" id="sidebar-user" style="display:none;">
        <span class="sidebar__user-email" id="sidebar-user-email"></span>
        <button type="button" id="btn-sign-out" class="btn-sign-out">Sign Out</button>
        <button type="button" id="btn-change-password" class="btn-sign-out" style="margin-top:0.35rem;">Change Password</button>
      </div>
    </div>
  </aside>

  <!-- Main content -->
  <main class="main">

    <!-- Customer List View -->
    <div id="view-customers" class="view">
      <div class="view__header">
        <div>
          <h1 class="view__title">Customers</h1>
          <p class="view__subtitle" id="customer-count">Loading...</p>
        </div>
        <button id="btn-add-customer" type="button">+ Add Customer</button>
      </div>

      <div class="search-bar">
        <input id="search-input" type="text" placeholder="Search by name, address or phone..." />
      </div>

      <div id="customer-list" class="customer-list">
        <!-- populated by JS -->
      </div>
    </div>

    <!-- Customer Detail View -->
    <div id="view-detail" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <button id="btn-back" class="ghost btn-back" type="button">‚Üê Back to customers</button>
          <div style="display:flex;align-items:baseline;gap:0.75rem;flex-wrap:wrap;">
            <h1 class="view__title" id="detail-name">Customer Name</h1>
            <span class="customer-number-badge" id="detail-customer-number"></span>
          </div>
          <p class="view__subtitle" id="detail-address"></p>
          <div id="customer-contact-warning" class="contact-warning" style="display:none;"></div>
        </div>
        <div class="detail-actions">
          <button id="btn-open-scheduler" type="button" class="ghost" onclick="">üìÖ Open in Scheduler</button>
          <button id="btn-edit-customer" type="button" class="ghost">Edit</button>
          <button id="btn-delete-customer" type="button" class="ghost danger">Delete</button>
        </div>
      </div>

      <div class="detail-grid">

        <!-- Account Holders -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Account Holders</h2>
            <button id="btn-add-contact" type="button" class="ghost ghost--small">+ Add Additional Contact</button>
          </div>
          <div id="account-holders" class="account-holders-grid"></div>
          <div id="contact-list" class="contact-list"></div>
        </section>

        <!-- Service Info -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Service Details</h2>
          </div>
          <div class="service-grid">
            <label>
              Plan
              <select id="detail-plan">
                <option value="">-- Select plan --</option>
                <option value="good-neighbor">Good Neighbor ($74/mo)</option>
                <option value="hero-pro">Hero Pro ($135/mo)</option>
                <option value="custom">Custom</option>
              </select>
            </label>
            <label>
              Start Date
              <input type="date" id="detail-start-date" />
            </label>
            <label>
              Minutes Limit per Visit
              <input type="number" id="detail-minutes" min="30" max="180" value="75" />
            </label>
            <label>
              Status
              <select id="detail-status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="prospect">Prospect</option>
              </select>
            </label>
            <label>
              Assigned Technician
              <select id="detail-technician">
                <option value="">-- Unassigned --</option>
              </select>
            </label>
          </div>
          <button id="btn-save-service" type="button" style="margin-top:1rem;">Save Service Details</button>
        </section>

        <!-- Appointments -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Appointments</h2>
            <button id="btn-add-customer-appointment" type="button" class="ghost ghost--small">+ Schedule Appointment</button>
          </div>
          <div id="customer-appointment-list"></div>
        </section>

        <!-- Annual Schedule -->
        <section class="card card--full" id="schedule-section">
          <div class="card__header">
            <div>
              <h2 style="margin:0;">Annual Schedule <span id="schedule-year" style="color:var(--muted);font-size:1rem;font-family:'Space Mono',monospace;"></span></h2>
            </div>
            <div style="display:flex;gap:0.5rem;">
              <button id="btn-print-schedule" type="button" class="ghost ghost--small">&#x1F5A8; Print Schedule</button>
              <button id="btn-edit-schedule" type="button" class="ghost ghost--small">Edit Schedule</button>
            </div>
          </div>
          <div id="schedule-card-body" style="margin-top:1rem;">
            <div class="empty-state"><p>Loading schedule...</p></div>
          </div>

        </section>

        <!-- Notes -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Notes</h2>
            <button id="btn-add-note" type="button" class="ghost">+ Add Note</button>
          </div>
          <div id="note-list" class="note-list"></div>
        </section>

      </div>
    </div>

    <!-- Prospect List View -->
    <div id="view-prospects" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <h1 class="view__title">Prospects</h1>
          <p class="view__subtitle" id="prospect-count">Loading...</p>
        </div>
        <div style="display:flex;flex-direction:column;gap:0.5rem;align-items:flex-end;">
          <button id="btn-add-prospect" type="button">+ Add Prospect</button>
          <button id="btn-followups-due" type="button">üìÖ Follow-Ups Due</button>
        </div>
      </div>

      <div class="pipeline-tabs" id="pipeline-tabs">
        <button class="pipeline-tab pipeline-tab--active" data-stage="all" type="button">All</button>
        <button class="pipeline-tab" data-stage="new" type="button">New Lead</button>
        <button class="pipeline-tab" data-stage="contacted" type="button">Contacted</button>
        <button class="pipeline-tab" data-stage="follow-up" type="button">Follow-up</button>
        <button class="pipeline-tab" data-stage="consult_scheduled" type="button">Consult Scheduled</button>
        <button class="pipeline-tab" data-stage="consultation" type="button">In-Home Consult</button>
        <button class="pipeline-tab" data-stage="proposal" type="button">Proposed Schedule Sent</button>
        <button class="pipeline-tab" data-stage="one_off" type="button">One-Off Client</button>
        <button class="pipeline-tab" data-stage="won" type="button">Won</button>
        <button class="pipeline-tab" data-stage="lost" type="button">Lost</button>
      </div>

      <div class="search-bar">
        <input id="prospect-search-input" type="text" placeholder="Search by name or address..." />
        <select id="prospect-source-filter">
          <option value="">All Sources</option>
          <option value="inbound">Inbound</option>
          <option value="referral">Referral</option>
          <option value="outreach">Outreach</option>
          <option value="social">Social Media</option>
          <option value="website">Website</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div id="prospect-list" class="customer-list">
        <!-- populated by JS -->
      </div>
    </div>

    <!-- Prospect Detail View -->
    <div id="view-prospect-detail" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <button id="btn-back-prospect" class="ghost btn-back" type="button">‚Üê Back to prospects</button>
          <h1 class="view__title" id="prospect-detail-name">Prospect Name</h1>
          <p class="view__subtitle" id="prospect-detail-address"></p>
          <div id="prospect-contact-warning" class="contact-warning" style="display:none;"></div>
        </div>
        <div class="detail-actions">
          <button id="btn-convert-prospect" type="button" class="convert-btn">‚úÖ Convert to Customer</button>
          <button id="btn-edit-prospect" type="button" class="ghost">Edit</button>
          <button id="btn-delete-prospect" type="button" class="ghost danger">Delete</button>
        </div>
      </div>

      <div class="detail-grid">

        <!-- Pipeline Stage -->
        <section class="card">
          <div class="card__header">
            <h2>Pipeline Status</h2>
          </div>
          <div class="service-grid">
            <label>
              Stage
              <select id="prospect-stage">
                <option value="new">New Lead</option>
                <option value="contacted">Contacted</option>
                <option value="follow-up">Follow-up</option>
                <option value="consult_scheduled">In-Home Consultation Scheduled</option>
                <option value="consultation">In-Home Consultation Complete</option>
                <option value="proposal">Proposed Schedule Sent</option>
                <option value="one_off">One-Off Client</option>
                <option value="won">Won</option>
                <option value="lost">Lost</option>
              </select>
            </label>
            <label>
              Lead Source
              <select id="prospect-source">
                <option value="">-- Select source --</option>
                <option value="inbound">Inbound (called us)</option>
                <option value="referral">Referral</option>
                <option value="outreach">Outreach</option>
                <option value="social">Social Media</option>
                <option value="website">Website</option>
                <option value="other">Other</option>
              </select>
            </label>
            <label>
              Last Contact Date
              <input type="date" id="prospect-last-contact" />
            </label>
            <label>
              Follow-up Date
              <input type="date" id="prospect-followup" />
            </label>
          </div>
          <button id="btn-save-prospect-status" type="button" style="margin-top:1rem;">Save Status</button>
        </section>

        <!-- Contact Info -->
        <section class="card">
          <div class="card__header">
            <h2>Contact Info</h2>
          </div>
          <div id="prospect-contact-info" class="prospect-contact-info"></div>
        </section>

        <!-- Appointments -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Appointments</h2>
            <button id="btn-add-prospect-appointment" type="button" class="ghost ghost--small">+ Schedule Appointment</button>
          </div>
          <div id="prospect-appointment-list"></div>
        </section>

        <!-- Contact Log -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Contact Log</h2>
            <button id="btn-add-contact-log" type="button" class="ghost">+ Log Contact</button>
          </div>
          <div id="contact-log-list"></div>
        </section>

        <!-- Notes -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Notes</h2>
            <button id="btn-add-prospect-note" type="button" class="ghost">+ Add Note</button>
          </div>
          <div id="prospect-note-list" class="note-list"></div>
        </section>

      </div>
    </div>

    <!-- Global Task Library View -->
    <div id="view-task-library" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <h1 class="view__title">Task Library</h1>
          <p class="view__subtitle">Master task list ‚Äî changes here apply to all new customers and can be pushed to existing ones</p>
        </div>
        <button id="btn-push-global-tasks" type="button" class="ghost">&#8593; Push updates to all customers</button>
      </div>
      <div class="card" style="margin-bottom:1.25rem;">
        <h2 style="margin:0 0 1rem;">Add New Task</h2>
        <form id="form-global-task" class="task-lib-form-add">
          <label style="flex:1 1 200px;">
            Task name
            <input id="gtask-name" type="text" placeholder="e.g. Pool Filter Clean" required />
          </label>
          <label style="flex:0 0 80px;">
            Minutes
            <input id="gtask-minutes" type="number" min="1" max="180" placeholder="15" required />
          </label>
          <label style="flex:0 0 180px;">
            Category
            <select id="gtask-category">
              <option value="Appliance Maintenance">Appliance Maintenance</option>
              <option value="Auto Maintenance">Auto Maintenance</option>
              <option value="Energy Efficiency">Energy Efficiency</option>
              <option value="Home Safety">Home Safety</option>
              <option value="HVAC">HVAC</option>
              <option value="Seasonal">Seasonal</option>
              <option value="Plumbing">Plumbing</option>
            </select>
          </label>
          <label style="flex:0 0 140px;">
            Frequency
            <select id="gtask-frequency">
              <option value="every">Every visit</option>
              <option value="annual">Annual</option>
              <option value="adhoc">Ad hoc</option>
            </select>
          </label>
          <div style="display:flex;align-items:flex-end;padding-bottom:2px;">
            <button type="submit">+ Add Task</button>
          </div>
        </form>
      </div>
      <div id="global-task-table"></div>
    </div>

    <!-- Master Schedule View -->
    <div id="view-schedule" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <h1 class="view__title">Schedule</h1>
          <p class="view__subtitle" id="schedule-master-subtitle">Annual Service Calendar</p>
        </div>
      </div>
      <div class="pipeline-tabs" id="master-period-tabs">
        <button class="pipeline-tab pipeline-tab--active" data-period="Jan - Feb" type="button">Jan ‚Äì Feb</button>
        <button class="pipeline-tab" data-period="Mar - Apr" type="button">Mar ‚Äì Apr</button>
        <button class="pipeline-tab" data-period="May - Jun" type="button">May ‚Äì Jun</button>
        <button class="pipeline-tab" data-period="Jul - Aug" type="button">Jul ‚Äì Aug</button>
        <button class="pipeline-tab" data-period="Sep - Oct" type="button">Sep ‚Äì Oct</button>
        <button class="pipeline-tab" data-period="Nov - Dec" type="button">Nov ‚Äì Dec</button>
      </div>
      <div id="master-schedule-list" style="margin-top:1.25rem;">
        <div class="empty-state"><p>Loading...</p></div>
      </div>
    </div>

    <!-- Technician List View -->
    <div id="view-technicians" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <h1 class="view__title">Technicians</h1>
          <p class="view__subtitle" id="technician-count">Loading...</p>
        </div>
        <button id="btn-add-technician" type="button">+ Add Technician</button>
      </div>
      <div id="technician-list" class="customer-list"></div>
    </div>

    <!-- Technician Detail View -->
    <div id="view-technician-detail" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <button id="btn-back-technician" class="ghost btn-back" type="button">‚Üê Back to technicians</button>
          <h1 class="view__title" id="technician-detail-name">Technician Name</h1>
          <p class="view__subtitle" id="technician-detail-role"></p>
        </div>
        <div class="detail-actions">
          <button id="btn-edit-technician" type="button" class="ghost">Edit</button>
          <button id="btn-delete-technician" type="button" class="ghost danger">Delete</button>
        </div>
      </div>
      <div class="detail-grid">
        <section class="card">
          <div class="card__header"><h2>Contact Info</h2></div>
          <div id="technician-contact-info" class="prospect-contact-info"></div>
        </section>
        <section class="card card--full">
          <div class="card__header"><h2>Assigned Customers</h2></div>
          <div id="technician-assigned-customers"></div>
        </section>
        <section class="card card--full">
          <div class="card__header">
            <h2>Upcoming Appointments</h2>
            <button id="btn-add-tech-appointment" type="button" class="ghost ghost--small">+ Schedule Appointment</button>
          </div>
          <div id="technician-appointment-list"></div>
        </section>
        <section class="card card--full">
          <div class="card__header">
            <h2>Weekly Availability</h2>
            <span style="font-size:0.78rem;color:var(--muted);align-self:center;">Repeats every week ‚Äî click + Add Hours to set blocks per day</span>
          </div>
          <div id="technician-weekly-availability"></div>
        </section>
        <section class="card card--full">
          <div class="card__header">
            <h2>Date Overrides</h2>
            <button id="btn-add-avail-override" type="button" class="ghost ghost--small">+ Add Override</button>
          </div>
          <p style="font-size:0.8rem;color:var(--muted);margin:0 0 0.5rem;">Override a specific date ‚Äî e.g. vacation, sick day, or custom hours different from the weekly schedule.</p>
          <div id="technician-override-list"></div>
        </section>
      </div>
    </div>

    <!-- Calendar View -->
    <div id="view-calendar" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <h1 class="view__title">Calendar</h1>
          <p class="view__subtitle" id="calendar-subtitle">Upcoming appointments</p>
        </div>
        <div style="display:flex;gap:0.5rem;align-items:center;">
          <button id="cal-closures-toggle" class="ghost" type="button" title="Show/hide company closures">üè¢ Closures</button>
          <button id="btn-add-calendar-appointment" type="button">+ Schedule Appointment</button>
        </div>
      </div>
      <div class="calendar-controls">
        <div class="calendar-view-toggle">
          <button class="pipeline-tab pipeline-tab--active" type="button" id="cal-tab-week">Week</button>
          <button class="pipeline-tab" type="button" id="cal-tab-month">Month</button>
        </div>
        <div class="calendar-nav">
          <button id="cal-prev" class="ghost ghost--small" type="button">&#8592; Prev</button>
          <button id="cal-today" class="ghost ghost--small" type="button">Today</button>
          <button id="cal-next" class="ghost ghost--small" type="button">Next &#8594;</button>
        </div>
        <select id="calendar-tech-filter">
          <option value="">All Technicians</option>
        </select>
      </div>
      <div id="calendar-grid" style="margin-top:1.25rem;"></div>
      <div class="company-closures-panel" id="company-closures-panel" style="display:none;margin-top:1.5rem;">
        <div class="card__header" style="margin-bottom:0.5rem;">
          <h2 style="font-size:1rem;">üè¢ Company Closures &amp; Holidays</h2>
          <button id="btn-add-closure" type="button" class="ghost ghost--small">+ Add Closure</button>
        </div>
        <p style="font-size:0.8rem;color:var(--muted);margin:0 0 0.75rem;">Dates when the entire company is closed ‚Äî affects all technicians.</p>
        <div id="company-closures-list"></div>
      </div>
    </div>

  </main>

  <!-- Modal: Add/Edit Customer -->
  <div id="modal-customer" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-customer-title">Add Customer</h2>
        <button class="modal__close" data-close="modal-customer" type="button">‚úï</button>
      </div>
      <form id="form-customer">
        <div class="form-grid">
          <label>
            First Name *
            <input type="text" id="cust-first" required placeholder="John" />
          </label>
          <label>
            Last Name *
            <input type="text" id="cust-last" required placeholder="Smith" />
          </label>
          <label class="span-2">
            Street Address
            <input type="text" id="cust-street" placeholder="123 Maple Drive" />
          </label>
          <label>
            City / Town
            <input type="text" id="cust-city" placeholder="Mountain Top" />
          </label>
          <label>
            State
            <input type="text" id="cust-state" placeholder="PA" maxlength="2" style="text-transform:uppercase;" />
          </label>
          <label>
            Zip Code
            <input type="text" id="cust-zip" placeholder="18707" maxlength="10" />
          </label>
          <label>
            Email
            <input type="email" id="cust-email" placeholder="john@email.com" />
          </label>
          <label>
            Phone
            <input type="tel" id="cust-phone" placeholder="(570) 555-1234" />
          </label>
          <label>
            Service Start Date
            <input type="date" id="cust-start-date" />
          </label>
        </div>

        <div class="form-section-divider">
          <span>Secondary Account Holder <em>(optional)</em></span>
        </div>
        <div class="form-grid">
          <label>
            First Name
            <input type="text" id="cust-second-first" placeholder="Mary" />
          </label>
          <label>
            Last Name
            <input type="text" id="cust-second-last" placeholder="Smith" />
          </label>
          <label>
            Relationship
            <select id="cust-second-rel">
              <option value="">-- Select --</option>
              <option value="spouse">Spouse</option>
              <option value="parent">Parent</option>
              <option value="child">Child</option>
              <option value="roommate">Roommate</option>
              <option value="landlord">Landlord</option>
            </select>
          </label>
          <label>
            Phone
            <input type="tel" id="cust-second-phone" placeholder="(570) 555-5678" />
          </label>
          <label class="span-2">
            Email
            <input type="email" id="cust-second-email" placeholder="mary@email.com" />
          </label>
        </div>
        <div class="modal__actions">
          <button type="submit">Save Customer</button>
          <button type="button" class="ghost" data-close="modal-customer">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add/Edit Contact -->
  <div id="modal-contact" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-contact-title">Add Contact</h2>
        <button class="modal__close" data-close="modal-contact" type="button">‚úï</button>
      </div>
      <form id="form-contact">
        <div class="form-grid">
          <label>
            First Name *
            <input type="text" id="contact-first" required placeholder="Mary" />
          </label>
          <label>
            Last Name *
            <input type="text" id="contact-last" required placeholder="Smith" />
          </label>
          <label>
            Role
            <input type="text" id="contact-role" placeholder="e.g. Spouse, Property Manager" />
          </label>
          <label>
            Email
            <input type="email" id="contact-email" placeholder="mary@email.com" />
          </label>
          <label>
            Phone
            <input type="tel" id="contact-phone" placeholder="(570) 555-5678" />
          </label>
          <label>
            Preferred Contact
            <select id="contact-preferred">
              <option value="phone">Phone</option>
              <option value="email">Email</option>
              <option value="text">Text</option>
            </select>
          </label>
        </div>
        <div class="modal__actions">
          <button type="submit">Save Contact</button>
          <button type="button" class="ghost" data-close="modal-contact">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add Note -->
  <div id="modal-note" class="modal" style="display:none;">
    <div class="modal__box modal__box--narrow">
      <div class="modal__header">
        <h2>Add Note</h2>
        <button class="modal__close" data-close="modal-note" type="button">‚úï</button>
      </div>
      <form id="form-note">
        <label>
          Note
          <textarea id="note-text" rows="5" placeholder="Enter note here..." required></textarea>
        </label>
        <div class="modal__actions">
          <button type="submit">Save Note</button>
          <button type="button" class="ghost" data-close="modal-note">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add/Edit Prospect -->
  <div id="modal-prospect" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-prospect-title">Add Prospect</h2>
        <button class="modal__close" data-close="modal-prospect" type="button">‚úï</button>
      </div>
      <form id="form-prospect">
        <div class="form-grid">
          <label>
            First Name *
            <input type="text" id="prospect-first" required placeholder="Jane" />
          </label>
          <label>
            Last Name *
            <input type="text" id="prospect-last" required placeholder="Doe" />
          </label>
          <label class="span-2">
            Street Address
            <input type="text" id="prospect-street" placeholder="123 Maple Drive" />
          </label>
          <label>
            City / Town
            <input type="text" id="prospect-city" placeholder="Mountain Top" />
          </label>
          <label>
            State
            <input type="text" id="prospect-state" placeholder="PA" maxlength="2" style="text-transform:uppercase;" />
          </label>
          <label>
            Zip Code
            <input type="text" id="prospect-zip" placeholder="18707" maxlength="10" />
          </label>
          <label>
            Email
            <input type="email" id="prospect-email" placeholder="jane@email.com" />
          </label>
          <label>
            Phone
            <input type="tel" id="prospect-phone" placeholder="(570) 555-1234" />
          </label>
          <label>
            Pipeline Stage
            <select id="prospect-form-stage">
              <option value="new">New Lead</option>
              <option value="contacted">Contacted</option>
              <option value="follow-up">Follow-up</option>
              <option value="consult_scheduled">In-Home Consultation Scheduled</option>
              <option value="consultation">In-Home Consultation Complete</option>
              <option value="proposal">Proposed Schedule Sent</option>
              <option value="won">Won</option>
              <option value="lost">Lost</option>
            </select>
          </label>
          <label>
            Lead Source
            <select id="prospect-form-source">
              <option value="">-- Select source --</option>
              <option value="inbound">Inbound (called us)</option>
              <option value="referral">Referral</option>
              <option value="outreach">Outreach</option>
              <option value="social">Social Media</option>
              <option value="website">Website</option>
              <option value="other">Other</option>
            </select>
          </label>
          <label>
            Last Contact Date
            <input type="date" id="prospect-form-last-contact" />
          </label>
          <label>
            Follow-up Date
            <input type="date" id="prospect-form-followup" />
          </label>
        </div>

        <div class="form-section-divider">
          <span>Secondary Account Holder <em>(optional)</em></span>
        </div>
        <div class="form-grid">
          <label>
            First Name
            <input type="text" id="prospect-second-first" placeholder="John" />
          </label>
          <label>
            Last Name
            <input type="text" id="prospect-second-last" placeholder="Doe" />
          </label>
          <label>
            Relationship
            <select id="prospect-second-rel">
              <option value="">-- Select --</option>
              <option value="spouse">Spouse</option>
              <option value="parent">Parent</option>
              <option value="child">Child</option>
              <option value="roommate">Roommate</option>
              <option value="landlord">Landlord</option>
            </select>
          </label>
          <label>
            Phone
            <input type="tel" id="prospect-second-phone" placeholder="(570) 555-5678" />
          </label>
          <label class="span-2">
            Email
            <input type="email" id="prospect-second-email" placeholder="john@email.com" />
          </label>
        </div>

        <div class="modal__actions">
          <button type="submit">Save Prospect</button>
          <button type="button" class="ghost" data-close="modal-prospect">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Log Contact -->
  <div id="modal-contact-log" class="modal" style="display:none;">
    <div class="modal__box modal__box--narrow">
      <div class="modal__header">
        <h2>Log Contact</h2>
        <button class="modal__close" data-close="modal-contact-log" type="button">‚úï</button>
      </div>
      <form id="form-contact-log">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
          <label>
            Date
            <input type="date" id="clog-date" required />
          </label>
          <label>
            Method
            <select id="clog-method">
              <option value="call">üìû Phone Call</option>
              <option value="text">üí¨ Text</option>
              <option value="email">‚úâÔ∏è Email</option>
              <option value="in-person">ü§ù In-Person</option>
            </select>
          </label>
        </div>
        <label style="margin-top:0.75rem;">
          Did they respond?
          <select id="clog-replied">
            <option value="yes">Yes</option>
            <option value="no">No ‚Äî no answer / no reply</option>
            <option value="na">N/A</option>
          </select>
        </label>
        <label style="margin-top:0.75rem;">
          Set follow-up date (optional)
          <input type="date" id="clog-followup" />
        </label>
        <label style="margin-top:0.75rem;">
          Comments
          <textarea id="clog-notes" rows="4" placeholder="e.g. Called back in May, not interested right now, try again in summer..."></textarea>
        </label>
        <div class="modal__actions">
          <button type="submit">Save Entry</button>
          <button type="button" class="ghost" data-close="modal-contact-log">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add Prospect Note -->
  <div id="modal-prospect-note" class="modal" style="display:none;">
    <div class="modal__box modal__box--narrow">
      <div class="modal__header">
        <h2>Add Note</h2>
        <button class="modal__close" data-close="modal-prospect-note" type="button">‚úï</button>
      </div>
      <form id="form-prospect-note">
        <label>
          Note
          <textarea id="prospect-note-text" rows="5" placeholder="Enter note here..." required></textarea>
        </label>
        <div class="modal__actions">
          <button type="submit">Save Note</button>
          <button type="button" class="ghost" data-close="modal-prospect-note">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add/Edit Technician -->
  <div id="modal-technician" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-technician-title">Add Technician</h2>
        <button class="modal__close" data-close="modal-technician" type="button">‚úï</button>
      </div>
      <form id="form-technician">
        <div class="form-grid">
          <label>
            First Name *
            <input type="text" id="tech-first" required placeholder="Jane" />
          </label>
          <label>
            Last Name *
            <input type="text" id="tech-last" required placeholder="Doe" />
          </label>
          <label>
            Phone
            <input type="tel" id="tech-phone" placeholder="(570) 555-1234" />
          </label>
          <label>
            Email
            <input type="email" id="tech-email" placeholder="jane@househeropa.com" />
          </label>
          <label>
            Role
            <select id="tech-role">
              <option value="lead">Lead Technician</option>
              <option value="assistant">Assistant</option>
              <option value="part-time">Part-Time</option>
              <option value="subcontractor">Subcontractor</option>
            </select>
          </label>
          <label>
            Status
            <select id="tech-status">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </label>
        </div>
        <div class="modal__actions">
          <button type="submit">Save Technician</button>
          <button type="button" class="ghost" data-close="modal-technician">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add/Edit Appointment -->
  <div id="modal-appointment" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-appointment-title">Schedule Appointment</h2>
        <button class="modal__close" data-close="modal-appointment" type="button">‚úï</button>
      </div>
      <form id="form-appointment">
        <div class="form-grid">
          <label>
            Type
            <select id="appt-type">
              <option value="maintenance">üîß Maintenance Visit</option>
              <option value="consult">üè† In-Home Consultation</option>
              <option value="work_order">üõ†Ô∏è Work Order</option>
              <option value="a_la_carte">‚ú® A La Carte Service</option>
            </select>
          </label>
          <label>
            Status
            <select id="appt-status">
              <option value="scheduled">Scheduled</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </label>
          <label>
            Date *
            <input type="date" id="appt-date" required />
          </label>
          <label>
            Start Time
            <input type="time" id="appt-start-time" />
          </label>
          <label>
            Duration (minutes)
            <input type="number" id="appt-duration" min="15" max="480" value="75" />
          </label>
          <label>
            Technician
            <select id="appt-technician">
              <option value="">-- Unassigned --</option>
            </select>
          </label>
          <label class="span-2" id="appt-contact-label">
            <span id="appt-contact-text">Customer</span>
            <select id="appt-customer">
              <option value="">-- No customer linked --</option>
            </select>
          </label>
          <label class="span-2">
            Notes
            <textarea id="appt-notes" rows="2" placeholder="Any notes about this appointment..."></textarea>
          </label>
          <div class="span-2" id="appt-work-order-section" style="display:none;">
            <div class="work-order-header">
              <span class="work-order-title">üìã Scheduled Tasks</span>
              <span class="work-order-period" id="appt-work-order-period"></span>
            </div>
            <div id="appt-tasks-list" class="appt-tasks-list"></div>
                    <!-- Add/Remove Tasks Controls -->
                    <div id="appt-task-controls" style="margin-top:0.5rem;">
                      <label style="display:block;margin-bottom:0.5rem;">
                        Add Task from Library:
                        <select id="appt-task-library-picker" style="min-width:180px;"></select>
                        <button type="button" id="btn-add-task-to-appt" class="ghost ghost--small" style="margin-left:0.5rem;">+ Add</button>
                      </label>
                      <label style="display:block;margin-bottom:0.5rem;">
                        Additional Task(s):
                        <input type="text" id="appt-additional-task" placeholder="Describe any extra task..." style="width:100%;margin-top:0.25rem;" />
                      </label>
                      <small style="color:var(--muted);">Remove a task by clicking the X next to it below.</small>
                    </div>
          </div>
          <label>
            Repeat
            <select id="appt-recurrence">
              <option value="">Does not repeat</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="bimonthly">Every 2 Months</option>
              <option value="quarterly">Quarterly</option>
              <option value="biannual">Every 6 Months</option>
              <option value="annual">Annually</option>
            </select>
          </label>
          <label id="appt-recurrence-end-row" style="display:none;">
            Repeat Until
            <input type="date" id="appt-recurrence-end" />
          </label>
        </div>
        <div class="modal__actions">
          <button type="submit">Save Appointment</button>
          <button type="button" id="btn-complete-appointment" class="ghost" style="display:none;"><span style="font-size:1.1em;vertical-align:middle;">üìù‚úîÔ∏è</span> Mark as Complete</button>
          <button type="button" id="btn-delete-appointment" class="ghost danger" style="display:none;">Delete</button>
          <button type="button" class="ghost" data-close="modal-appointment">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Availability Override / Company Closure -->
  <div id="modal-avail-override" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-avail-override-title">Add Date Override</h2>
        <button class="modal__close" data-close="modal-avail-override" type="button">‚úï</button>
      </div>
      <form id="form-avail-override">
        <div class="form-grid">
          <label>
            Date *
            <input type="date" id="ao-date" required />
          </label>
          <label id="ao-type-row">
            Type
            <select id="ao-type">
              <option value="day_off">Day Off (unavailable)</option>
              <option value="custom">Custom Hours</option>
            </select>
          </label>
          <label class="span-2">
            Note / Name
            <input type="text" id="ao-note" placeholder='e.g. "Vacation", "Doctor appt", "Thanksgiving"' />
          </label>
          <div class="span-2" id="ao-blocks-section" style="display:none;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
              <span style="font-size:0.88rem;font-weight:600;">Available Hours on This Date</span>
              <button type="button" id="btn-ao-add-block" class="ghost ghost--small">+ Add Block</button>
            </div>
            <div id="ao-blocks-list"></div>
          </div>
          <input type="hidden" id="ao-tech-id" />
        </div>
        <div class="modal__actions">
          <button type="submit">Save</button>
          <button type="button" id="btn-delete-avail-override" class="ghost danger" style="display:none;">Delete</button>
          <button type="button" class="ghost" data-close="modal-avail-override">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Complete Appointment Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="modal-complete-appt" class="modal" style="display:none;">
    <div class="modal__box" style="max-width:480px;">
      <div class="modal__header">
        <h2 id="modal-complete-appt-title">Complete Appointment</h2>
        <button type="button" class="modal__close" data-close="modal-complete-appt">&times;</button>
      </div>
      <form id="form-complete-appt">
        <div class="form-grid">
          <div class="span-2">
            <p id="complete-appt-meta" style="font-size:0.85rem;color:var(--muted);margin:0 0 0.75rem;"></p>
          </div>
          <div class="span-2" id="complete-appt-tasks-section">
            <div class="work-order-header">
              <span class="work-order-title">üìã Tasks Completed?</span>
              <span class="work-order-period" id="complete-appt-period"></span>
            </div>
            <div id="complete-appt-tasks-list"></div>
          </div>
          <label class="span-2">
            Additional Work Performed
            <textarea id="complete-appt-additional-work" rows="3" placeholder="Anything done that wasn't on the scheduled task list..."></textarea>
          </label>
        </div>
        <div class="modal__actions">
          <button type="submit">Save &amp; Complete</button>
          <button type="button" class="ghost" data-close="modal-complete-appt">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Duplicate Check Modal -->
  <div id="modal-dup-check" class="modal" style="display:none;">
    <div class="modal__box" style="max-width:500px;">
      <div class="modal__header">
        <h2>‚ö†Ô∏è Possible Duplicate</h2>
        <button type="button" class="modal__close" data-close="modal-dup-check">‚úï</button>
      </div>
      <p style="margin:0 0 1rem;color:var(--text);">One or more existing records look similar. Review before saving:</p>
      <div id="dup-check-list"></div>
      <div class="modal__actions">
        <button type="button" id="btn-dup-continue">Save Anyway</button>
        <button type="button" class="ghost" id="btn-dup-cancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id="modal-change-password" class="modal" style="display:none;">
    <div class="modal__box" style="max-width:380px;">
      <div class="modal__header">
        <h2>Change Password</h2>
        <button type="button" class="modal__close" data-close="modal-change-password">&times;</button>
      </div>
      <form id="form-change-password">
        <div class="form-grid">
          <label class="span-2">
            New Password
            <input type="password" id="change-pw-new" required minlength="8" autocomplete="new-password" placeholder="At least 8 characters" />
          </label>
          <label class="span-2">
            Confirm Password
            <input type="password" id="change-pw-confirm" required minlength="8" autocomplete="new-password" placeholder="Re-enter password" />
          </label>
          <div id="change-pw-error" class="span-2 login-error" style="display:none;"></div>
        </div>
        <div class="modal__actions">
          <button type="submit" id="btn-change-pw-submit">Save Password</button>
          <button type="button" class="ghost" data-close="modal-change-password">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Password Reset Screen -->
  <div id="password-reset-screen" style="display:none;">
    <div class="login-card">
      <div class="login-brand">
        <img src="logo.png" alt="House Hero" class="login-logo"
          onerror="this.style.display='none'" />
      </div>
      <h1 class="login-title">Set Your Password</h1>
      <form id="form-set-password">
        <label class="login-label">
          New Password
          <input type="password" id="reset-password" required autocomplete="new-password" placeholder="At least 8 characters" minlength="8" />
        </label>
        <label class="login-label">
          Confirm Password
          <input type="password" id="reset-password-confirm" required autocomplete="new-password" placeholder="Re-enter password" minlength="8" />
        </label>
        <div id="reset-error" class="login-error" style="display:none;"></div>
        <button type="submit" id="btn-reset-submit" class="login-btn">Save Password</button>
      </form>
    </div>
  </div>

  <!-- Login Screen Overlay -->
  <div id="login-screen" style="display:none;">
    <div class="login-card">
      <div class="login-brand">
        <img src="logo.png" alt="House Hero" class="login-logo"
          onerror="this.style.display='none'; document.getElementById('login-brand-fallback').style.display='block'" />
        <div id="login-brand-fallback" style="display:none">
          <div class="login-brand__name">House Hero</div>
          <div class="login-brand__sub">CRM</div>
        </div>
      </div>
      <h1 class="login-title">Sign In</h1>
      <form id="form-login">
        <label class="login-label">
          Email
          <input type="email" id="login-email" required autocomplete="username" placeholder="you@example.com" />
        </label>
        <label class="login-label">
          Password
          <input type="password" id="login-password" required autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </label>
        <div id="login-error" class="login-error" style="display:none;"></div>
        <button type="submit" id="btn-login-submit" class="login-btn">Sign In</button>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app.js"></script>
</body>
</html>
