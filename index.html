<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>House Hero CRM</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,400;0,700;0,900;1,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar__brand">
      <img src="logo.png" alt="House Hero" class="sidebar__logo"
        onerror="this.style.display='none'; document.getElementById('brand-fallback').style.display='block'" />
      <div id="brand-fallback" style="display:none">
        <div class="sidebar__brand-name">House Hero</div>
        <div class="sidebar__brand-sub">CRM</div>
      </div>
    </div>
    <nav class="sidebar__nav">
      <a href="#" class="sidebar__link sidebar__link--active" data-view="customers">
        <span class="sidebar__icon">üë•</span> Customers
      </a>
      <a href="#" class="sidebar__link" data-view="prospects">
        <span class="sidebar__icon">üéØ</span> Prospects
      </a>
      <a href="#" class="sidebar__link" data-view="schedule">
        <span class="sidebar__icon">üìÖ</span> Schedule
      </a>
      <a href="#" class="sidebar__link" data-view="task-library">
        <span class="sidebar__icon">üìã</span> Task Library
      </a>
    </nav>
    <div class="sidebar__footer">
      <div class="sidebar__footer-text">House Hero LLC</div>
      <div class="sidebar__footer-sub">PA Registered &amp; Insured</div>
    </div>
  </aside>

  <!-- Main content -->
  <main class="main">

    <!-- Customer List View -->
    <div id="view-customers" class="view">
      <div class="view__header">
        <div>
          <h1 class="view__title">Customers</h1>
          <p class="view__subtitle" id="customer-count">Loading...</p>
        </div>
        <button id="btn-add-customer" type="button">+ Add Customer</button>
      </div>

      <div class="search-bar">
        <input id="search-input" type="text" placeholder="Search by name, address or phone..." />
      </div>

      <div id="customer-list" class="customer-list">
        <!-- populated by JS -->
      </div>
    </div>

    <!-- Customer Detail View -->
    <div id="view-detail" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <button id="btn-back" class="ghost btn-back" type="button">‚Üê Back to customers</button>
          <div style="display:flex;align-items:baseline;gap:0.75rem;flex-wrap:wrap;">
            <h1 class="view__title" id="detail-name">Customer Name</h1>
            <span class="customer-number-badge" id="detail-customer-number"></span>
          </div>
          <p class="view__subtitle" id="detail-address"></p>
        </div>
        <div class="detail-actions">
          <button id="btn-open-scheduler" type="button" class="ghost" onclick="">üìÖ Open in Scheduler</button>
          <button id="btn-edit-customer" type="button" class="ghost">Edit</button>
          <button id="btn-delete-customer" type="button" class="ghost danger">Delete</button>
        </div>
      </div>

      <div class="detail-grid">

        <!-- Account Holders -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Account Holders</h2>
            <button id="btn-add-contact" type="button" class="ghost ghost--small">+ Add Additional Contact</button>
          </div>
          <div id="account-holders" class="account-holders-grid"></div>
          <div id="contact-list" class="contact-list"></div>
        </section>

        <!-- Service Info -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Service Details</h2>
          </div>
          <div class="service-grid">
            <label>
              Plan
              <select id="detail-plan">
                <option value="">-- Select plan --</option>
                <option value="good-neighbor">Good Neighbor ($74/mo)</option>
                <option value="hero-pro">Hero Pro ($135/mo)</option>
                <option value="custom">Custom</option>
              </select>
            </label>
            <label>
              Start Date
              <input type="date" id="detail-start-date" />
            </label>
            <label>
              Minutes Limit per Visit
              <input type="number" id="detail-minutes" min="30" max="180" value="75" />
            </label>
            <label>
              Status
              <select id="detail-status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="prospect">Prospect</option>
              </select>
            </label>
          </div>
          <button id="btn-save-service" type="button" style="margin-top:1rem;">Save Service Details</button>
        </section>

        <!-- Annual Schedule -->
        <section class="card card--full" id="schedule-section">
          <div class="card__header">
            <div>
              <h2 style="margin:0;">Annual Schedule <span id="schedule-year" style="color:var(--muted);font-size:1rem;font-family:'Space Mono',monospace;"></span></h2>
            </div>
            <div style="display:flex;gap:0.5rem;">
              <button id="btn-print-schedule" type="button" class="ghost ghost--small">&#x1F5A8; Print Schedule</button>
              <button id="btn-edit-schedule" type="button" class="ghost ghost--small">Edit Schedule</button>
            </div>
          </div>
          <div id="schedule-card-body" style="margin-top:1rem;">
            <div class="empty-state"><p>Loading schedule...</p></div>
          </div>

        </section>

        <!-- Notes -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Notes</h2>
            <button id="btn-add-note" type="button" class="ghost">+ Add Note</button>
          </div>
          <div id="note-list" class="note-list"></div>
        </section>

      </div>
    </div>

    <!-- Prospect List View -->
    <div id="view-prospects" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <h1 class="view__title">Prospects</h1>
          <p class="view__subtitle" id="prospect-count">Loading...</p>
        </div>
        <button id="btn-add-prospect" type="button">+ Add Prospect</button>
      </div>

      <div class="pipeline-tabs" id="pipeline-tabs">
        <button class="pipeline-tab pipeline-tab--active" data-stage="all" type="button">All</button>
        <button class="pipeline-tab" data-stage="new" type="button">New Lead</button>
        <button class="pipeline-tab" data-stage="contacted" type="button">Contacted</button>
        <button class="pipeline-tab" data-stage="follow-up" type="button">Follow-up</button>
        <button class="pipeline-tab" data-stage="consultation" type="button">In-Home Consult</button>
        <button class="pipeline-tab" data-stage="proposal" type="button">Proposed Schedule Sent</button>
        <button class="pipeline-tab" data-stage="won" type="button">Won</button>
        <button class="pipeline-tab" data-stage="lost" type="button">Lost</button>
      </div>

      <div class="search-bar">
        <input id="prospect-search-input" type="text" placeholder="Search by name or address..." />
      </div>

      <div id="prospect-list" class="customer-list">
        <!-- populated by JS -->
      </div>
    </div>

    <!-- Prospect Detail View -->
    <div id="view-prospect-detail" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <button id="btn-back-prospect" class="ghost btn-back" type="button">‚Üê Back to prospects</button>
          <h1 class="view__title" id="prospect-detail-name">Prospect Name</h1>
          <p class="view__subtitle" id="prospect-detail-address"></p>
        </div>
        <div class="detail-actions">
          <button id="btn-convert-prospect" type="button" class="convert-btn">‚úÖ Convert to Customer</button>
          <button id="btn-edit-prospect" type="button" class="ghost">Edit</button>
          <button id="btn-delete-prospect" type="button" class="ghost danger">Delete</button>
        </div>
      </div>

      <div class="detail-grid">

        <!-- Pipeline Stage -->
        <section class="card">
          <div class="card__header">
            <h2>Pipeline Status</h2>
          </div>
          <div class="service-grid">
            <label>
              Stage
              <select id="prospect-stage">
                <option value="new">New Lead</option>
                <option value="contacted">Contacted</option>
                <option value="follow-up">Follow-up</option>
                <option value="consultation">In-Home Consultation Complete</option>
                <option value="proposal">Proposed Schedule Sent</option>
                <option value="won">Won</option>
                <option value="lost">Lost</option>
              </select>
            </label>
            <label>
              Lead Source
              <select id="prospect-source">
                <option value="">-- Select source --</option>
                <option value="inbound">Inbound (called us)</option>
                <option value="referral">Referral</option>
                <option value="outreach">Outreach</option>
                <option value="social">Social Media</option>
                <option value="website">Website</option>
                <option value="other">Other</option>
              </select>
            </label>
            <label>
              Last Contact Date
              <input type="date" id="prospect-last-contact" />
            </label>
            <label>
              Follow-up Date
              <input type="date" id="prospect-followup" />
            </label>
          </div>
          <button id="btn-save-prospect-status" type="button" style="margin-top:1rem;">Save Status</button>
        </section>

        <!-- Contact Info -->
        <section class="card">
          <div class="card__header">
            <h2>Contact Info</h2>
          </div>
          <div id="prospect-contact-info" class="prospect-contact-info"></div>
        </section>

        <!-- Contact Log -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Contact Log</h2>
            <button id="btn-add-contact-log" type="button" class="ghost">+ Log Contact</button>
          </div>
          <div id="contact-log-list"></div>
        </section>

        <!-- Notes -->
        <section class="card card--full">
          <div class="card__header">
            <h2>Notes</h2>
            <button id="btn-add-prospect-note" type="button" class="ghost">+ Add Note</button>
          </div>
          <div id="prospect-note-list" class="note-list"></div>
        </section>

      </div>
    </div>

    <!-- Global Task Library View -->
    <div id="view-task-library" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <h1 class="view__title">Task Library</h1>
          <p class="view__subtitle">Master task list ‚Äî changes here apply to all new customers and can be pushed to existing ones</p>
        </div>
        <button id="btn-push-global-tasks" type="button" class="ghost">&#8593; Push updates to all customers</button>
      </div>
      <div class="card" style="margin-bottom:1.25rem;">
        <h2 style="margin:0 0 1rem;">Add New Task</h2>
        <form id="form-global-task" class="task-lib-form-add">
          <label style="flex:1 1 200px;">
            Task name
            <input id="gtask-name" type="text" placeholder="e.g. Pool Filter Clean" required />
          </label>
          <label style="flex:0 0 80px;">
            Minutes
            <input id="gtask-minutes" type="number" min="1" max="180" placeholder="15" required />
          </label>
          <label style="flex:0 0 180px;">
            Category
            <select id="gtask-category">
              <option value="Appliance Maintenance">Appliance Maintenance</option>
              <option value="Auto Maintenance">Auto Maintenance</option>
              <option value="Energy Efficiency">Energy Efficiency</option>
              <option value="Home Safety">Home Safety</option>
              <option value="HVAC">HVAC</option>
              <option value="Seasonal">Seasonal</option>
              <option value="Plumbing">Plumbing</option>
            </select>
          </label>
          <label style="flex:0 0 140px;">
            Frequency
            <select id="gtask-frequency">
              <option value="every">Every visit</option>
              <option value="annual">Annual</option>
              <option value="adhoc">Ad hoc</option>
            </select>
          </label>
          <div style="display:flex;align-items:flex-end;padding-bottom:2px;">
            <button type="submit">+ Add Task</button>
          </div>
        </form>
      </div>
      <div id="global-task-table"></div>
    </div>

    <!-- Master Schedule View -->
    <div id="view-schedule" class="view" style="display:none;">
      <div class="view__header">
        <div>
          <h1 class="view__title">Schedule</h1>
          <p class="view__subtitle" id="schedule-master-subtitle">Annual Service Calendar</p>
        </div>
      </div>
      <div class="pipeline-tabs" id="master-period-tabs">
        <button class="pipeline-tab pipeline-tab--active" data-period="Jan - Feb" type="button">Jan ‚Äì Feb</button>
        <button class="pipeline-tab" data-period="Mar - Apr" type="button">Mar ‚Äì Apr</button>
        <button class="pipeline-tab" data-period="May - Jun" type="button">May ‚Äì Jun</button>
        <button class="pipeline-tab" data-period="Jul - Aug" type="button">Jul ‚Äì Aug</button>
        <button class="pipeline-tab" data-period="Sep - Oct" type="button">Sep ‚Äì Oct</button>
        <button class="pipeline-tab" data-period="Nov - Dec" type="button">Nov ‚Äì Dec</button>
      </div>
      <div id="master-schedule-list" style="margin-top:1.25rem;">
        <div class="empty-state"><p>Loading...</p></div>
      </div>
    </div>

  </main>

  <!-- Modal: Add/Edit Customer -->
  <div id="modal-customer" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-customer-title">Add Customer</h2>
        <button class="modal__close" data-close="modal-customer" type="button">‚úï</button>
      </div>
      <form id="form-customer">
        <div class="form-grid">
          <label>
            First Name *
            <input type="text" id="cust-first" required placeholder="John" />
          </label>
          <label>
            Last Name *
            <input type="text" id="cust-last" required placeholder="Smith" />
          </label>
          <label class="span-2">
            Street Address
            <input type="text" id="cust-street" placeholder="123 Maple Drive" />
          </label>
          <label>
            City / Town
            <input type="text" id="cust-city" placeholder="Mountain Top" />
          </label>
          <label>
            State
            <input type="text" id="cust-state" placeholder="PA" maxlength="2" style="text-transform:uppercase;" />
          </label>
          <label>
            Zip Code
            <input type="text" id="cust-zip" placeholder="18707" maxlength="10" />
          </label>
          <label>
            Email
            <input type="email" id="cust-email" placeholder="john@email.com" />
          </label>
          <label>
            Phone
            <input type="tel" id="cust-phone" placeholder="(570) 555-1234" />
          </label>
          <label>
            Service Start Date
            <input type="date" id="cust-start-date" />
          </label>
        </div>

        <div class="form-section-divider">
          <span>Secondary Account Holder <em>(optional)</em></span>
        </div>
        <div class="form-grid">
          <label>
            First Name
            <input type="text" id="cust-second-first" placeholder="Mary" />
          </label>
          <label>
            Last Name
            <input type="text" id="cust-second-last" placeholder="Smith" />
          </label>
          <label>
            Relationship
            <select id="cust-second-rel">
              <option value="">-- Select --</option>
              <option value="spouse">Spouse</option>
              <option value="parent">Parent</option>
              <option value="child">Child</option>
              <option value="roommate">Roommate</option>
              <option value="landlord">Landlord</option>
            </select>
          </label>
          <label>
            Phone
            <input type="tel" id="cust-second-phone" placeholder="(570) 555-5678" />
          </label>
          <label class="span-2">
            Email
            <input type="email" id="cust-second-email" placeholder="mary@email.com" />
          </label>
        </div>
        <div class="modal__actions">
          <button type="submit">Save Customer</button>
          <button type="button" class="ghost" data-close="modal-customer">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add/Edit Contact -->
  <div id="modal-contact" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-contact-title">Add Contact</h2>
        <button class="modal__close" data-close="modal-contact" type="button">‚úï</button>
      </div>
      <form id="form-contact">
        <div class="form-grid">
          <label>
            First Name *
            <input type="text" id="contact-first" required placeholder="Mary" />
          </label>
          <label>
            Last Name *
            <input type="text" id="contact-last" required placeholder="Smith" />
          </label>
          <label>
            Role
            <input type="text" id="contact-role" placeholder="e.g. Spouse, Property Manager" />
          </label>
          <label>
            Email
            <input type="email" id="contact-email" placeholder="mary@email.com" />
          </label>
          <label>
            Phone
            <input type="tel" id="contact-phone" placeholder="(570) 555-5678" />
          </label>
          <label>
            Preferred Contact
            <select id="contact-preferred">
              <option value="phone">Phone</option>
              <option value="email">Email</option>
              <option value="text">Text</option>
            </select>
          </label>
        </div>
        <div class="modal__actions">
          <button type="submit">Save Contact</button>
          <button type="button" class="ghost" data-close="modal-contact">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add Note -->
  <div id="modal-note" class="modal" style="display:none;">
    <div class="modal__box modal__box--narrow">
      <div class="modal__header">
        <h2>Add Note</h2>
        <button class="modal__close" data-close="modal-note" type="button">‚úï</button>
      </div>
      <form id="form-note">
        <label>
          Note
          <textarea id="note-text" rows="5" placeholder="Enter note here..." required></textarea>
        </label>
        <div class="modal__actions">
          <button type="submit">Save Note</button>
          <button type="button" class="ghost" data-close="modal-note">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add/Edit Prospect -->
  <div id="modal-prospect" class="modal" style="display:none;">
    <div class="modal__box">
      <div class="modal__header">
        <h2 id="modal-prospect-title">Add Prospect</h2>
        <button class="modal__close" data-close="modal-prospect" type="button">‚úï</button>
      </div>
      <form id="form-prospect">
        <div class="form-grid">
          <label>
            First Name *
            <input type="text" id="prospect-first" required placeholder="Jane" />
          </label>
          <label>
            Last Name *
            <input type="text" id="prospect-last" required placeholder="Doe" />
          </label>
          <label class="span-2">
            Street Address
            <input type="text" id="prospect-street" placeholder="123 Maple Drive" />
          </label>
          <label>
            City / Town
            <input type="text" id="prospect-city" placeholder="Mountain Top" />
          </label>
          <label>
            State
            <input type="text" id="prospect-state" placeholder="PA" maxlength="2" style="text-transform:uppercase;" />
          </label>
          <label>
            Zip Code
            <input type="text" id="prospect-zip" placeholder="18707" maxlength="10" />
          </label>
          <label>
            Email
            <input type="email" id="prospect-email" placeholder="jane@email.com" />
          </label>
          <label>
            Phone
            <input type="tel" id="prospect-phone" placeholder="(570) 555-1234" />
          </label>
          <label>
            Pipeline Stage
            <select id="prospect-form-stage">
              <option value="new">New Lead</option>
              <option value="contacted">Contacted</option>
              <option value="follow-up">Follow-up</option>
              <option value="consultation">In-Home Consultation Complete</option>
              <option value="proposal">Proposed Schedule Sent</option>
              <option value="won">Won</option>
              <option value="lost">Lost</option>
            </select>
          </label>
          <label>
            Lead Source
            <select id="prospect-form-source">
              <option value="">-- Select source --</option>
              <option value="inbound">Inbound (called us)</option>
              <option value="referral">Referral</option>
              <option value="outreach">Outreach</option>
              <option value="social">Social Media</option>
              <option value="website">Website</option>
              <option value="other">Other</option>
            </select>
          </label>
          <label>
            Last Contact Date
            <input type="date" id="prospect-form-last-contact" />
          </label>
          <label>
            Follow-up Date
            <input type="date" id="prospect-form-followup" />
          </label>
        </div>
        <div class="modal__actions">
          <button type="submit">Save Prospect</button>
          <button type="button" class="ghost" data-close="modal-prospect">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Log Contact -->
  <div id="modal-contact-log" class="modal" style="display:none;">
    <div class="modal__box modal__box--narrow">
      <div class="modal__header">
        <h2>Log Contact</h2>
        <button class="modal__close" data-close="modal-contact-log" type="button">‚úï</button>
      </div>
      <form id="form-contact-log">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
          <label>
            Date
            <input type="date" id="clog-date" required />
          </label>
          <label>
            Method
            <select id="clog-method">
              <option value="call">üìû Phone Call</option>
              <option value="text">üí¨ Text</option>
              <option value="email">‚úâÔ∏è Email</option>
              <option value="in-person">ü§ù In-Person</option>
            </select>
          </label>
        </div>
        <label style="margin-top:0.75rem;">
          Did they respond?
          <select id="clog-replied">
            <option value="yes">Yes</option>
            <option value="no">No ‚Äî no answer / no reply</option>
            <option value="na">N/A</option>
          </select>
        </label>
        <label style="margin-top:0.75rem;">
          Set follow-up date (optional)
          <input type="date" id="clog-followup" />
        </label>
        <label style="margin-top:0.75rem;">
          Comments
          <textarea id="clog-notes" rows="4" placeholder="e.g. Called back in May, not interested right now, try again in summer..."></textarea>
        </label>
        <div class="modal__actions">
          <button type="submit">Save Entry</button>
          <button type="button" class="ghost" data-close="modal-contact-log">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Add Prospect Note -->
  <div id="modal-prospect-note" class="modal" style="display:none;">
    <div class="modal__box modal__box--narrow">
      <div class="modal__header">
        <h2>Add Note</h2>
        <button class="modal__close" data-close="modal-prospect-note" type="button">‚úï</button>
      </div>
      <form id="form-prospect-note">
        <label>
          Note
          <textarea id="prospect-note-text" rows="5" placeholder="Enter note here..." required></textarea>
        </label>
        <div class="modal__actions">
          <button type="submit">Save Note</button>
          <button type="button" class="ghost" data-close="modal-prospect-note">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app.js"></script>
</body>
</html>
